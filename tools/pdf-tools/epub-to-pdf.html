<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="epubToPdf.title">ePub to PDF ë³€í™˜ê¸° - ë¬´ë£Œ ì˜¨ë¼ì¸ ë³€í™˜ ë„êµ¬</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="ePub íŒŒì¼ì„ PDFë¡œ ë¬´ë£Œ ë³€í™˜. ë¸Œë¼ìš°ì €ì—ì„œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë˜ë©° ê°œì¸ì •ë³´ê°€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤." data-i18n-content="epubToPdf.description">
    <meta name="keywords" content="ePub PDF ë³€í™˜, ì „ìì±… ë³€í™˜, ë¬´ë£Œ ë³€í™˜ê¸°, ePub to PDF, ì˜¨ë¼ì¸ ë³€í™˜ ë„êµ¬" data-i18n-content="epubToPdf.keywords">
    
    <!-- Open Graph -->
    <meta property="og:title" content="ePub to PDF ë³€í™˜ê¸° - ë¬´ë£Œ ì˜¨ë¼ì¸ ë³€í™˜ ë„êµ¬">
    <meta property="og:description" content="ePub íŒŒì¼ì„ PDFë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜í•˜ì„¸ìš”. ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì²˜ë¦¬ë˜ì–´ ê°œì¸ì •ë³´ ë³´í˜¸ê°€ ë³´ì¥ë©ë‹ˆë‹¤.">
    <meta property="og:type" content="website">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9434360911371069"
     crossorigin="anonymous"></script>
    
    <!-- Cookie Consent Management -->
    <script src="../../cookie-consent.js"></script>
    
    <!-- Feedback System -->
    <script src="../../feedback.js"></script>
    
    <!-- i18n System -->
    <script src="../../i18n.js"></script>
    
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- ePub Parser Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .nav-bar {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 60px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .nav-brand {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 10px 16px;
            border-radius: 5px;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 14px;
            font-weight: 500;
        }
        
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        
        .menu-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        @media (max-width: 768px) {
            .nav-bar {
                padding: 12px 15px;
                min-height: 50px;
                position: relative;
            }
            
            .nav-brand {
                font-size: 1.3em;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(10px);
                border-radius: 0 0 10px 10px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.3);
                flex-direction: column;
                gap: 0;
                padding: 15px 0;
                z-index: 1000;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-top: none;
            }
            
            .nav-links.active {
                display: flex;
            }
            
            .nav-link {
                padding: 12px 20px;
                font-size: 16px;
                border-radius: 0;
                display: block;
                width: 100%;
                text-align: left;
                transition: background-color 0.3s ease;
            }
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            background: linear-gradient(135deg, #e8f0ff 0%, #d8e8ff 100%);
            transform: translateY(-2px);
        }
        
        .upload-area.dragover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: white;
        }
        
        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .upload-area.dragover .upload-icon {
            color: white;
        }
        
        .upload-text {
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .upload-subtext {
            color: #666;
            font-size: 1em;
        }
        
        .upload-area.dragover .upload-subtext {
            color: rgba(255, 255, 255, 0.8);
        }
        
        #fileInput {
            display: none;
        }
        
        .file-info {
            display: none;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .file-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .file-size {
            color: #666;
            font-size: 0.9em;
        }
        
        .options-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .option-group {
            margin-bottom: 20px;
        }
        
        .option-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .option-group select,
        .option-group input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: #667eea;
        }
        
        .convert-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            min-width: 200px;
        }
        
        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .convert-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-section {
            display: none;
            text-align: center;
            margin: 30px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 10px;
        }
        
        .download-section {
            display: none;
            text-align: center;
            margin: 30px 0;
            padding: 25px;
            background: #e8f5e8;
            border-radius: 10px;
            border: 1px solid #4caf50;
        }
        
        .download-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
        }
        
        .download-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .features-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .feature-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .feature-description {
            color: #666;
            line-height: 1.5;
        }
        
        .error-message {
            display: none;
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #ef5350;
        }
        
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .language-switcher select {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            color: #333;
            padding: 8px 12px;
            font-size: 14px;
            width: 90px;
        }
        
        @media (max-width: 768px) {
            .main-layout {
                padding: 15px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .upload-area {
                padding: 40px 15px;
            }
            
            .features-section {
                grid-template-columns: 1fr;
            }
            
            .language-switcher {
                top: 15px;
                right: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <select id="languageSelect">
            <option value="ko" data-i18n="common.languageKo">ğŸ‡°ğŸ‡· KO</option>
            <option value="en" data-i18n="common.languageEn">ğŸ‡ºğŸ‡¸ EN</option>
        </select>
    </div>

    <div class="nav-bar">
        <a href="../../index.html" class="nav-brand" data-i18n="common.siteTitle">ğŸ› ï¸ ì›¹ ë„êµ¬ ëª¨ìŒ</a>
        <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
        <div class="nav-links" id="navLinks">
            <a href="../password-generator/password.html" class="nav-link" data-i18n="common.passwordGenerator">ë¹„ë°€ë²ˆí˜¸ ìƒì„±ê¸°</a>
            <a href="png-converter.html" class="nav-link" data-i18n="common.pdfConverter">PDF ë³€í™˜ê¸°</a>
            <a href="hwp-converter.html" class="nav-link">PDF to HWP</a>
            <a href="epub-to-pdf.html" class="nav-link active">ePub to PDF</a>
            <a href="../image-tools/webp-to-jpg.html" class="nav-link">WEBP to JPG</a>
            <a href="../file-conversion/file-conversion.html" class="nav-link" data-i18n="common.fileConverter">íŒŒì¼ ë³€í™˜ ê°€ì´ë“œ</a>
        </div>
    </div>
    
    <div class="main-layout">
        <div class="container">
            <h1 data-i18n="epubToPdf.mainTitle">ğŸ“š ePub to PDF ë³€í™˜ê¸°</h1>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“š</div>
                <div class="upload-text" data-i18n="epubToPdf.uploadText">ePub íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                <div class="upload-subtext" data-i18n="epubToPdf.uploadSubtext">ì§€ì› í˜•ì‹: .epub (ìµœëŒ€ 50MB)</div>
                <input type="file" id="fileInput" accept=".epub" />
            </div>
            
            <div class="file-info" id="fileInfo">
                <div class="file-name" id="fileName"></div>
                <div class="file-size" id="fileSize"></div>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <div class="options-section">
                <h3 data-i18n="epubToPdf.options">ë³€í™˜ ì˜µì…˜</h3>
                
                <div class="option-group">
                    <label for="pageSize">í˜ì´ì§€ í¬ê¸°:</label>
                    <select id="pageSize">
                        <option value="a4">A4 (210 Ã— 297 mm)</option>
                        <option value="letter">Letter (8.5 Ã— 11 inch)</option>
                        <option value="legal">Legal (8.5 Ã— 14 inch)</option>
                        <option value="a3">A3 (297 Ã— 420 mm)</option>
                    </select>
                </div>
                
                <div class="option-group">
                    <label for="fontSize">ê¸€ê¼´ í¬ê¸°: <span class="range-value" id="fontSizeValue">12px</span></label>
                    <input type="range" id="fontSize" min="8" max="24" value="12" />
                </div>
                
                <div class="option-group">
                    <label for="lineHeight">ì¤„ ê°„ê²©: <span class="range-value" id="lineHeightValue">1.5</span></label>
                    <input type="range" id="lineHeight" min="1" max="3" step="0.1" value="1.5" />
                </div>
                
                <div class="option-group">
                    <label for="margin">ì—¬ë°±: <span class="range-value" id="marginValue">20mm</span></label>
                    <input type="range" id="margin" min="10" max="50" value="20" />
                </div>
            </div>
            
            <button class="convert-btn" id="convertBtn" disabled>ë³€í™˜í•˜ê¸°</button>
            
            <div class="progress-section" id="progressSection">
                <div class="progress-text" id="progressText">ë³€í™˜ ì¤‘...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <div class="download-section" id="downloadSection">
                <h3>âœ… ë³€í™˜ ì™„ë£Œ!</h3>
                <p>ePub íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ PDFë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                <a href="#" class="download-btn" id="downloadBtn">ğŸ“¥ PDF ë‹¤ìš´ë¡œë“œ</a>
            </div>
            
            <div class="features-section">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”’</div>
                    <div class="feature-title">ê°œì¸ì •ë³´ ë³´í˜¸</div>
                    <div class="feature-description">ëª¨ë“  ë³€í™˜ ì‘ì—…ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì²˜ë¦¬ë˜ì–´ íŒŒì¼ì´ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <div class="feature-title">ë¹ ë¥¸ ë³€í™˜</div>
                    <div class="feature-description">ìµœì í™”ëœ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë¹ ë¥´ê³  ì •í™•í•œ ePub to PDF ë³€í™˜ì„ ì œê³µí•©ë‹ˆë‹¤.</div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">ğŸ¨</div>
                    <div class="feature-title">ì»¤ìŠ¤í„°ë§ˆì´ì§•</div>
                    <div class="feature-description">í˜ì´ì§€ í¬ê¸°, ê¸€ê¼´, ì—¬ë°± ë“±ì„ ììœ ë¡­ê²Œ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“±</div>
                    <div class="feature-title">ëª¨ë“  ê¸°ê¸° ì§€ì›</div>
                    <div class="feature-description">PC, íƒœë¸”ë¦¿, ëª¨ë°”ì¼ ë“± ëª¨ë“  ê¸°ê¸°ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class EpubToPdfConverter {
            constructor() {
                this.currentFile = null;
                this.initializeElements();
                this.bindEvents();
                this.updateRangeValues();
            }
            
            initializeElements() {
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.fileInfo = document.getElementById('fileInfo');
                this.fileName = document.getElementById('fileName');
                this.fileSize = document.getElementById('fileSize');
                this.convertBtn = document.getElementById('convertBtn');
                this.progressSection = document.getElementById('progressSection');
                this.progressText = document.getElementById('progressText');
                this.progressFill = document.getElementById('progressFill');
                this.downloadSection = document.getElementById('downloadSection');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.errorMessage = document.getElementById('errorMessage');
                
                // Option elements
                this.pageSize = document.getElementById('pageSize');
                this.fontSize = document.getElementById('fontSize');
                this.lineHeight = document.getElementById('lineHeight');
                this.margin = document.getElementById('margin');
            }
            
            bindEvents() {
                // File input events
                this.uploadArea.addEventListener('click', () => this.fileInput.click());
                this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
                
                // Drag and drop events
                this.uploadArea.addEventListener('dragover', (e) => this.handleDragOver(e));
                this.uploadArea.addEventListener('dragleave', (e) => this.handleDragLeave(e));
                this.uploadArea.addEventListener('drop', (e) => this.handleDrop(e));
                
                // Convert button
                this.convertBtn.addEventListener('click', () => this.convertToPdf());
                
                // Range inputs
                this.fontSize.addEventListener('input', () => this.updateRangeValues());
                this.lineHeight.addEventListener('input', () => this.updateRangeValues());
                this.margin.addEventListener('input', () => this.updateRangeValues());
            }
            
            updateRangeValues() {
                document.getElementById('fontSizeValue').textContent = this.fontSize.value + 'px';
                document.getElementById('lineHeightValue').textContent = this.lineHeight.value;
                document.getElementById('marginValue').textContent = this.margin.value + 'mm';
            }
            
            handleDragOver(e) {
                e.preventDefault();
                this.uploadArea.classList.add('dragover');
            }
            
            handleDragLeave(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
            }
            
            handleDrop(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    this.processFile(files[0]);
                }
            }
            
            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.processFile(file);
                }
            }
            
            processFile(file) {
                this.hideError();
                
                // Validate file type
                if (!file.name.toLowerCase().endsWith('.epub')) {
                    this.showError('ePub íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // Validate file size (50MB limit)
                if (file.size > 50 * 1024 * 1024) {
                    this.showError('íŒŒì¼ í¬ê¸°ê°€ 50MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.');
                    return;
                }
                
                this.currentFile = file;
                this.displayFileInfo(file);
                this.convertBtn.disabled = false;
            }
            
            displayFileInfo(file) {
                this.fileName.textContent = file.name;
                this.fileSize.textContent = this.formatFileSize(file.size);
                this.fileInfo.style.display = 'block';
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.style.display = 'block';
            }
            
            hideError() {
                this.errorMessage.style.display = 'none';
            }
            
            updateProgress(percent, text) {
                this.progressFill.style.width = percent + '%';
                this.progressText.textContent = text;
            }
            
            async convertToPdf() {
                if (!this.currentFile) return;
                
                this.convertBtn.disabled = true;
                this.progressSection.style.display = 'block';
                this.downloadSection.style.display = 'none';
                this.hideError();
                
                try {
                    this.updateProgress(10, 'ePub íŒŒì¼ ì½ëŠ” ì¤‘...');
                    
                    // Read ePub file
                    const epubContent = await this.readEpubFile(this.currentFile);
                    
                    this.updateProgress(40, 'ePub ë‚´ìš© íŒŒì‹± ì¤‘...');
                    
                    // Parse ePub content
                    const parsedContent = await this.parseEpubContent(epubContent);
                    
                    this.updateProgress(70, 'PDF ìƒì„± ì¤‘...');
                    
                    // Generate PDF
                    const pdfBlob = await this.generatePdf(parsedContent);
                    
                    this.updateProgress(100, 'ë³€í™˜ ì™„ë£Œ!');
                    
                    // Show download section
                    this.showDownloadSection(pdfBlob);
                    
                } catch (error) {
                    console.error('ë³€í™˜ ì¤‘ ì˜¤ë¥˜:', error);
                    this.showError('ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                } finally {
                    this.convertBtn.disabled = false;
                    this.progressSection.style.display = 'none';
                }
            }
            
            async readEpubFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
                    reader.readAsArrayBuffer(file);
                });
            }
            
            async parseEpubContent(arrayBuffer) {
                try {
                    const zip = await JSZip.loadAsync(arrayBuffer);
                    
                    // Read container.xml to find the content.opf file
                    const containerXml = await zip.file('META-INF/container.xml').async('text');
                    const containerDoc = new DOMParser().parseFromString(containerXml, 'text/xml');
                    const rootFilePath = containerDoc.querySelector('rootfile').getAttribute('full-path');
                    
                    // Read content.opf
                    const contentOpf = await zip.file(rootFilePath).async('text');
                    const contentDoc = new DOMParser().parseFromString(contentOpf, 'text/xml');
                    
                    // Get spine order
                    const spineItems = Array.from(contentDoc.querySelectorAll('spine itemref'));
                    const manifestItems = Array.from(contentDoc.querySelectorAll('manifest item'));
                    
                    // Extract text content from HTML files
                    const textContent = [];
                    const basePath = rootFilePath.substring(0, rootFilePath.lastIndexOf('/') + 1);
                    
                    for (const spineItem of spineItems) {
                        const idref = spineItem.getAttribute('idref');
                        const manifestItem = manifestItems.find(item => item.getAttribute('id') === idref);
                        
                        if (manifestItem) {
                            const href = manifestItem.getAttribute('href');
                            const fullPath = basePath + href;
                            
                            try {
                                const htmlContent = await zip.file(fullPath).async('text');
                                const htmlDoc = new DOMParser().parseFromString(htmlContent, 'text/html');
                                
                                // Extract text from HTML
                                const textElements = htmlDoc.querySelectorAll('p, h1, h2, h3, h4, h5, h6, div');
                                for (const element of textElements) {
                                    const text = element.textContent.trim();
                                    if (text) {
                                        textContent.push({
                                            text: text,
                                            tag: element.tagName.toLowerCase()
                                        });
                                    }
                                }
                            } catch (error) {
                                console.warn('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨:', fullPath);
                            }
                        }
                    }
                    
                    return textContent;
                } catch (error) {
                    throw new Error('ePub íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨: ' + error.message);
                }
            }
            
            async generatePdf(content) {
                const { jsPDF } = window.jspdf;
                
                // Get options
                const pageSize = this.pageSize.value;
                const fontSize = parseInt(this.fontSize.value);
                const lineHeight = parseFloat(this.lineHeight.value);
                const margin = parseInt(this.margin.value);
                
                // Create PDF
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: pageSize
                });
                
                // Get page dimensions
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const contentWidth = pageWidth - (margin * 2);
                const contentHeight = pageHeight - (margin * 2);
                
                let yPosition = margin;
                
                // Add content
                for (const item of content) {
                    // Set font size based on element type
                    let currentFontSize = fontSize;
                    if (item.tag.startsWith('h')) {
                        const headingLevel = parseInt(item.tag.substring(1));
                        currentFontSize = fontSize + (6 - headingLevel) * 2;
                    }
                    
                    pdf.setFontSize(currentFontSize);
                    
                    // Split text to fit width
                    const lines = pdf.splitTextToSize(item.text, contentWidth);
                    
                    // Check if we need a new page
                    const lineHeight_mm = (currentFontSize * lineHeight) / 3.5; // Convert to mm
                    const requiredHeight = lines.length * lineHeight_mm;
                    
                    if (yPosition + requiredHeight > contentHeight + margin) {
                        pdf.addPage();
                        yPosition = margin;
                    }
                    
                    // Add text
                    for (const line of lines) {
                        pdf.text(line, margin, yPosition);
                        yPosition += lineHeight_mm;
                    }
                    
                    // Add some space after paragraphs
                    if (item.tag === 'p') {
                        yPosition += lineHeight_mm * 0.5;
                    }
                }
                
                // Return PDF as blob
                return pdf.output('blob');
            }
            
            showDownloadSection(pdfBlob) {
                const url = URL.createObjectURL(pdfBlob);
                const fileName = this.currentFile.name.replace(/\.epub$/i, '.pdf');
                
                this.downloadBtn.href = url;
                this.downloadBtn.download = fileName;
                this.downloadSection.style.display = 'block';
                
                // Clean up URL after download
                this.downloadBtn.addEventListener('click', () => {
                    setTimeout(() => URL.revokeObjectURL(url), 100);
                });
            }
        }
        
        // Initialize converter
        document.addEventListener('DOMContentLoaded', () => {
            new EpubToPdfConverter();
        });
        
        // Mobile menu toggle
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            const navBar = document.querySelector('.nav-bar');
            const navLinks = document.getElementById('navLinks');
            if (!navBar.contains(e.target) && navLinks.classList.contains('active')) {
                navLinks.classList.remove('active');
            }
        });
        
        // Close menu when window is resized
        window.addEventListener('resize', function() {
            const navLinks = document.getElementById('navLinks');
            if (window.innerWidth > 768) {
                navLinks.classList.remove('active');
            }
        });
    </script>
</body>
</html>